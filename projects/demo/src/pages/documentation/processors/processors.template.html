<tui-doc-page header="Processors">
    <section class="tui-space_bottom-12">
        <p class="tui-space_top-0">
            <a
                href="https://github.com/Tinkoff/maskito/blob/main/projects/core/src/lib/types/mask-options.ts"
                target="_blank"
                tuiLink
            >
                <code>MaskitoOptions</code>
            </a>
            have optional parameters
            <code>preprocessors</code>
            and
            <code>postprocessors</code>
            . They are functions triggered on every user's input (
            <a
                href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/beforeinput_event"
                target="_blank"
                tuiLink
            >
                beforeinput
            </a>
            and
            <a
                href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/input_event"
                target="_blank"
                tuiLink
            >
                input
            </a>
            events). They provide with an opportunity to modify value
            before / after mask's operations.
        </p>

        <section>
            <p class="tui-space_bottom-1">
                Preprocessors and postprocessors accept different types of
                arguments but they have two important similarities:
            </p>
            <ul class="tui-list">
                <li class="tui-list__item">
                    The first argument always contains object with all mutable
                    information. Object with the same properties (but not
                    compulsory with the same values!) can be returned from the
                    processor. It means that you can keep all properties
                    untouched (and make function just to return the same object)
                    or you can change any of these properties (or even change
                    everything!). The returned value will be passed into the
                    mask.
                </li>
                <li class="tui-list__item">
                    The further arguments contain immutable information that can
                    be useful to build some complex logic, but you cannot change
                    it.
                </li>
            </ul>
        </section>
    </section>

    <section class="tui-space_bottom-12">
        <h2>What is element state?</h2>

        <p>
            Before you learn more about processors, you should learn a single
            prerequisite – meaning of term
            <strong>"element state"</strong>
            . It describes objects which implements
            <a
                href="https://github.com/Tinkoff/maskito/blob/main/projects/core/src/lib/types/element-state.ts"
                target="_blank"
                tuiLink
            >
                <code>ElementState</code>
            </a>
            -interface:
            <tui-doc-code
                class="tui-space_top-1 tui-space_bottom-1"
                [code]="elementStateDemo"
            ></tui-doc-code>
            Processors actively use this concept. Developer who writes new
            processor has direct access to element state of the masked input or
            textarea. Element state can be read and even changed via processors.
        </p>
    </section>

    <section class="tui-space_bottom-12">
        <h2>Preprocessor</h2>

        <p class="tui-space_bottom-0">
            It is a function that is called
            <strong>before</strong>
            each mask's operation.
        </p>
        <p class="tui-space_top-0 tui-space_bottom-0">
            For example, if user types new character, then the processor will be
            called first, and only then returned value (from the processor) will
            be passed into the mask, and finally the mask will accept or reject
            new typed character and insert it to the element.
        </p>

        <section class="tui-space_bottom-6">
            <p>Preprocessor accepts two arguments:</p>
            <ol class="tui-list tui-list_ordered">
                <li class="tui-list__item">
                    <strong>
                        Object with two properties:
                        <code>elementState</code>
                        and
                        <code>data</code>
                        .
                    </strong>
                    Object with the same properties (but not compulsory with the
                    same values!) can returned from the preprocessor.

                    <tui-doc-code
                        class="tui-space_top-1"
                        [code]="preprocessorFirstArgDemo"
                    ></tui-doc-code>
                </li>
                <li class="tui-list__item">
                    Name of action which triggers current execution. It can with
                    the following possible values:
                    <tui-doc-code
                        [code]="preprocessorsSecondArgDemo"
                    ></tui-doc-code>
                </li>
            </ol>
        </section>

        <p>
            Preprocessor returns the same objects as the first argument (it can
            contain other values, but it must implement the same interface).
        </p>

        <tui-doc-code [code]="preprocessorInActionDemo"></tui-doc-code>
    </section>

    <section class="tui-space_bottom-12">
        <h2>Postprocessor</h2>

        <p class="tui-space_bottom-0">
            It is a function that is called
            <strong>after</strong>
            each mask's operation. When the preprocessor are already called, all
            mask operations happened and the input's value is about to be
            updated. You can change everything manually!
        </p>

        <section class="tui-space_bottom-6">
            <p>Postprocessor accepts two arguments:</p>
            <ol class="tui-list tui-list_ordered">
                <li class="tui-list__item">
                    <strong>Element state after all mask's operations.</strong>
                    Object with the same properties (but not compulsory with the
                    same values!) can returned from the preprocessor.
                </li>
                <li class="tui-list__item">
                    <strong>
                        Initial element state before preprocessor's executiton
                        and all mask's operations.
                    </strong>
                    It is a readonly argument (of course, you can't change the
                    past!).
                </li>
            </ol>
        </section>

        <p>
            Postprocessor returns the same objects as the first argument (it can
            contain other values, but it must implement the same interface).
        </p>

        <tui-notification
            status="warning"
            class="tui-space_bottom-4"
        >
            <p class="tui-space_top-0 tui-space_bottom-0">
                <strong>With great power comes great responsibility!</strong>
            </p>

            <p class="tui-space_bottom-0">
                Postprocessor is the final step before input's value update
                which gives a lot of flexibility. Use postprocessor wisely and
                return valid value!
            </p>
        </tui-notification>

        <tui-doc-code [code]="postprocessorInActionDemo"></tui-doc-code>
    </section>

    <section class="tui-space_bottom-12">
        <h2>maskitoPipe</h2>

        <p>
            The Maskito team likes code decomposition and promotes it! Don't put
            all complex logic inside the single processor. Break it into the
            several processors so that each processor implements only a single
            task.
        </p>

        <p>
            Use the built-in
            <code>maskitoPipe</code>
            to stack multiple processors of the same type:
        </p>

        <tui-doc-code [code]="maskitoPipeDemo"></tui-doc-code>
    </section>

    <section>
        <h2>Next steps</h2>

        <p>
            The following sections are recommended to explore core concepts
            further:
        </p>

        <ul class="tui-list">
            <li class="tui-list__item">
                <a
                    tuiLink
                    [routerLink]="maskExpressionDocPage"
                >
                    Mask expression
                </a>
            </li>
            <li class="tui-list__item">
                <a
                    routerLink="#todo"
                    tuiLink
                >
                    Overwrite mode
                </a>
            </li>
        </ul>
    </section>
</tui-doc-page>
